# 브라우저 렌더링 과정

- [브라우저 렌더링 과정]

  - [브라우저의 렌더링 과정에 대해 설명해보세요] 🔥
  - [브라우저의 렌더링 과정에 자바스크립트는 어떻게 동작하나요?] 🔥
  - [`<script></script>` 태그를 `<body></body>` 태그 밑에 둬야하는 이유가 있을까요?]

## <span style='background-color: #fff5b1; color: black' id='meta0'>브라우저의 렌더링 과정에 대해 설명해보세요 🔥</span>

웹 브라우저의 렌더링 과정은 웹 페이지를 화면에 표시하기 위한 과정을 나타내며 다음과 같이 여러 단계로 구성됩니다:

1. **HTML 파싱(HTML Parsing)**:
   - 브라우저는 웹 페이지의 HTML 코드를 읽고 파싱합니다. 파싱은 HTML 코드를 트리 구조인 "DOM(Document Object Model)"으로 변환하는 과정입니다.
   - 파서(Parser)가 HTML 문서를 시작 태그부터 끝 태그까지 읽으며, 태그, 요소, 속성 및 텍스트 내용을 식별합니다.
   - HTML에 CSS가 포함되었다면 CSSOM (CSS Object Model) 구성
2. **CSS 파싱(CSS Parsing)**:
   - 브라우저는 웹 페이지에 연결된 CSS 스타일 시트를 파싱합니다. CSS 파서는 스타일 규칙을 분석하고 스타일 정보를 DOM 트리의 각 요소에 적용합니다.
   - 스타일 규칙은 선택자(selector)와 선언(declaration)으로 구성되며, 선택자가 일치하는 요소에 선언된 스타일이 적용됩니다.
     ⇒ Render 트리 생성 : DOM 트리와 CSSOM 트리를 결합하여 생성
3. **레이아웃(Layout)**:
   - 브라우저는 스타일 정보와 DOM 트리를 기반으로 각 요소의 크기, 위치 및 상대적인 배치를 계산합니다. 이 과정을 레이아웃 또는 리플로우(reflow)라고 합니다.
   - 레이아웃 단계에서 브라우저는 요소의 크기를 결정하고 화면에 배치합니다.
4. **페인팅(Painting)**:
   - 브라우저는 화면에 표시할 내용을 그리기 위해 레이아웃 정보와 스타일 정보를 사용하여 각 요소를 그립니다. 이 과정을 페인팅 또는 리페인트(repaint)라고 합니다.
   - 브라우저는 화면을 페인트하는 동안 픽셀 값을 계산하고 색상을 채우며 렌더링합니다.
5. **합성(Compositing)**:
   - 합성 단계에서 브라우저는 화면의 여러 레이어를 합성하여 최종 화면을 생성합니다. 레이어는 각 요소 또는 그룹에 대한 그래픽 컨텍스트를 나타냅니다.
   - 이 단계에서 브라우저는 각 레이어를 겹치고 투명도를 처리하여 최종 화면을 만듭니다.
   -
6. **화면에 표시(Display)**: - 마지막으로, 브라우저는 생성된 최종 화면을 사용자의 디스플레이에 표시합니다. 이 때, 화면에 보이는 내용이 사용자에게 렌더링된 웹 페이지가 됩니다.
   웹 브라우저의 렌더링 과정은 사용자가 웹 페이지를 요청하면 시작되며, 각 단계는 최적화되어 웹 페이지를 빠르게 표시하도록 노력합니다. 이러한 렌더링 과정은 웹 개발자가 웹 페이지의 성능을 향상시키고 최적화하는 데 중요한 역할을 합니다.

## <span style='background-color: #fff5b1; color: black' id='meta0'>브라우저의 렌더링 과정에 자바스크립트는 어떻게 동작하나요?</span>

브라우저의 렌더링 과정에 자바스크립트가 어떻게 동작하는지 이해하기 위해서는 먼저 브라우저의 렌더링 과정과 자바스크립트의 실행 순서를 파악해야 합니다. 다음은 브라우저의 렌더링 과정과 자바스크립트 실행에 관한 간략한 설명입니다:

1. **HTML 파싱과 DOM 구축**:

- 브라우저가 웹 페이지의 HTML을 다운로드하면 HTML 파서가 이를 파싱하여 DOM(Document Object Model) 트리를 생성합니다. DOM은 웹 페이지의 구조를 나타내며, 각 HTML 요소는 DOM 노드로 변환됩니다.

2. **CSS 파싱과 스타일 계산**:

- 브라우저는 CSS 스타일 시트를 파싱하고 스타일 규칙을 적용하여 각 DOM 요소의 스타일을 계산합니다. 이 단계에서는 각 요소의 레이아웃 정보가 결정되지 않습니다.

3. **레이아웃 계산**:

- DOM 요소와 스타일 정보를 기반으로 브라우저는 레이아웃을 계산합니다. 이 과정은 각 요소의 크기와 위치를 결정하는 것을 포함합니다.

4. **페인팅과 합성**:

- 브라우저는 화면에 표시할 내용을 그리기 위해 레이아웃 정보와 스타일 정보를 사용하여 각 요소를 그립니다. 이 과정은 페인팅 단계와 합성 단계로 나뉩니다.

5. **자바스크립트 실행**:

- HTML 파싱과 CSS 파싱, 레이아웃 계산이 진행되는 동안 자바스크립트 코드를 만나면 브라우저는 해당 코드를 실행합니다.
- 일반적으로 자바스크립트 코드는 `<script>` 태그를 통해 HTML에 포함되거나, 외부 파일로 로드됩니다. 코드 실행은 동기적으로 또는 비동기적으로 발생할 수 있습니다.

6. **DOM 조작과 이벤트 처리**:

- 자바스크립트는 DOM을 조작하고 이벤트를 처리하는 데 사용됩니다. 이 과정에서 DOM 요소를 변경하거나 이벤트 리스너를 등록할 수 있습니다.

7. **재페인팅과 재합성**:

- 자바스크립트로 인해 DOM이 변경되면 해당 요소와 관련된 부분을 다시 페인트하고 합성합니다. 이 과정은 리플로우와 리페인트를 유발할 수 있습니다.

8. **화면 갱신**:

- 변경된 내용이 화면에 반영되고, 사용자가 볼 수 있게 됩니다.

자바스크립트는 브라우저의 렌더링 과정 중간에 실행되므로, DOM 조작, 이벤트 처리, 애니메이션 및 Ajax 요청과 같은 웹 페이지의 동적인 부분을 제어하는 데 사용됩니다. 때때로 자바스크립트 실행이 렌더링 성능에 영향을 미치므로 최적화와 관련된 주의가 필요합니다. 이러한 이유로 브라우저는 비동기적으로 자바스크립트를 실행하는 기술도 제공합니다.

### 자바스크립트 파싱과 실행

HTML 문서를 파싱한 결과물로 생성된 DOM은 HTML 문서의 구조와 정보뿐만 아니라 HTML 요소와 스타일 등을 변경할 수 있는 프로그래밍 인터페이스로서 DOM API를 제공한다. 자바스크립트 코드에서 DOM API를 사용하면 DOM을 동적으로 조작할 수 있다.

CSS 파싱 과정과 마찬가지로 렌더링 엔진은 HTML을 한 줄씩 순차적으로 파싱하여 DOM을 생성해 나가다가 자바스크립트 파일을 로드하는 script 태그나 자바스크립트 코드를 만나면 DOM 생성을 일시 중단한다.

그리고 자바스크립트 코드를 파싱하기 위해 자바스크립트 엔진에 제어권을 넘긴다.

이후 자바스크립트 파싱이 종료되면 HTML 파싱이 중단된 지점부터 다시 HTML을 파싱한다.

자바스크립트 파싱과 실행은 브라우저의 렌더링 엔진이 아닌 자바스크립트 엔진이 처리한다.

자바스크립트 엔진은 구글 크롬과 Node.js의 V8, 파이어 폭스의 SpiderMonkey 등 다양한 종류가 있으며,

모든 자바스크립트 엔진은 ECMAScript 사양을 준수한다.

렌더링 엔진으로부터 제어권을 넘겨받은 자바스크립트 엔진은 자바스크립트 코드를 파싱하기 시작한다.

렌더링 엔진이 HTM과 CSS를 파싱하여 DOM과 CSSOM을 생성하듯이 자바스크립트 엔진은 자바스크립트를 해석하여 AST(추상적 구문 트리)를 생성한다. 그리고 AST를 기반으로 인터프리터가 실행할 수 있는 중간 코드인 바이트코드를 생성하여 실행한다.

- AST (추상적 구문 트리)
  추상적 구문 트리(Abstract Syntax Tree, AST)는 프로그래밍 언어의 소스 코드를 추상적인 구문 구조로 나타낸 트리 자료 구조입니다. AST는 컴파일러, 인터프리터, 코드 분석 도구 등 다양한 소프트웨어 도구에서 사용되며, 소스 코드의 구문을 분석하고 이해하는 데 도움을 줍니다.
  AST의 주요 특징과 역할에 대해 설명하겠습니다:

1. **구문 구조 표현**:
   - AST는 프로그래밍 언어의 소스 코드를 추상적인 구문 구조로 나타냅니다. 이 구조는 언어의 문법 규칙을 기반으로 하며, 소스 코드의 요소들(변수, 함수, 조건문, 반복문 등)과 그들 간의 관계를 표현합니다.
2. **컴파일러 및 인터프리터의 중간 단계**:
   - 컴파일러와 인터프리터는 소스 코드를 실행 가능한 코드로 변환하는 과정에서 AST를 사용합니다. 소스 코드를 파싱한 후, AST를 생성하고 이를 기반으로 중간 코드 또는 실행 코드를 생성합니다.
3. **코드 분석 도구**:
   - 코드 분석 도구(정적 분석 도구, 코드 포맷터, 코드 검색 도구 등)는 AST를 사용하여 소스 코드를 분석하고 수정하는 데 활용합니다. 예를 들어, 코드 검색 도구는 특정 패턴을 검색하거나 코드를 정적으로 분석하여 잠재적인 버그를 찾을 때 AST를 활용합니다.
4. **트리 구조**:
   - AST는 트리 구조를 가지며, 일반적으로 루트 노드에서 시작하여 하위 노드로 내려가는 형태입니다. 루트 노드는 전체 소스 코드를 대표하며, 각 노드는 소스 코드의 요소(예: 변수 선언, 함수 호출, 제어문 등)를 나타냅니다.
5. **코드 변환 및 최적화**: - AST를 통해 소스 코드를 변환하거나 최적화할 수 있습니다. 예를 들어, JavaScript 코드를 다른 언어로 변환하거나, 코드를 최적화하여 실행 속도를 향상시키는 데 사용됩니다.
   AST는 프로그래밍 언어의 소스 코드를 기계가 이해하기 쉬운 구조로 변환하는 데 도움을 주며, 다양한 소프트웨어 개발 및 분석 도구에 핵심적으로 사용됩니다.

## <span style='background-color: #fff5b1; color: black' id='meta0'>`<script></script>` 태그를 `<body></body>` 태그 밑에 둬야하는 이유가 있을까요?</span>

`<script></script>` 태그를 `<body></body>` 태그 아래에 두는 이유는 일반적으로 웹 페이지의 렌더링과 관련이 있습니다. 다음은 이유와 관련된 주요 내용입니다:

1. **렌더링 지연 방지**: 웹 브라우저는 HTML 문서를 위에서 아래로 순차적으로 파싱하고 렌더링합니다. 즉, 브라우저가 `<script></script>` 태그를 만나면 스크립트를 다운로드하고 실행하기 위해 렌더링을 차단합니다. 따라서 `<script>` 태그를 `<body>` 태그의 끝 부분에 두면 페이지의 나머지 내용을 먼저 렌더링한 다음 스크립트를 실행하므로 사용자가 페이지를 더 빠르게 볼 수 있습니다.
2. **DOM 조작에 접근**: `<script>` 태그를 `<body>` 태그 아래에 두면 스크립트가 실행될 때 DOM(Document Object Model) 요소에 더 쉽게 접근할 수 있습니다. 웹 페이지의 요소들이 모두 렌더링된 후에 스크립트가 실행되므로, 스크립트에서 페이지의 요소에 쉽게 접근하고 조작할 수 있습니다.
3. **렌더링 블로킹 방지**: `<script>` 태그를 `<body>` 태그의 끝에 두면 브라우저가 페이지의 나머지 내용을 로드하고 렌더링한 다음 스크립트를 처리하므로, 스크립트의 다운로드와 실행이 렌더링을 차단하는 것을 방지할 수 있습니다. 이로써 사용자 경험을 개선할 수 있습니다.
4. **자원 로드 순서 제어**: `<script>` 태그를 `<body>` 태그 아래에 둔다면, 스크립트 파일의 로딩 순서와 실행 순서를 더 명확하게 제어할 수 있습니다. 이것은 특히 다양한 스크립트 파일 간의 의존성을 관리할 때 유용합니다.
   그러나 모든 상황에서 `<script>` 태그를 `<body>` 태그의 끝에 두는 것이 항상 적합한 것은 아닙니다. 몇 가지 예외적인 상황에서는 `<head>` 태그 내에 스크립트를 배치하는 것이 유용할 수 있습니다. 예를 들어, 스크립트가 페이지 렌더링과 관련 없는 설정 작업을 수행해야 하는 경우 또는 스크립트가 페이지 로딩 전에 반드시 실행되어야 하는 경우 등이 있습니다. 페이지의 요구 사항에 따라 스크립트 위치를 결정해야 합니다.
   **HTML 파싱이 끝나고 DOM 트리가 생기기 전**에 자바스크립트가 실행되어 DOM 조작을 할 경우 에러가 발생할 수 있다

- HTML을 읽는 과정에서 중간에 스크립트를 만나면 스크립트 로드와 실행을 위해서 중단되는 시점이 생기고, 그에 따라 그 만큼 Display에 표시되는 것이 지연되게 된다.
- HTML 파싱이 끝나고 DOM 트리가 생기기 전 자바스크립트가 실행되어 DOM 조작을 할 경우 에러가 발생할 수 있다.

- async / defer
  JavaScript 파일을 HTML 문서 상단에 위치시키는 것은 일반적으로 권장되지 않는데, 이는 웹 페이지의 렌더링과 JavaScript 코드 실행에 관련된 문제 때문입니다. 그러나 `async` 및 `defer` 속성을 사용하면 JavaScript 파일을 상단에 배치해도 일부 문제를 완화할 수 있습니다.

1. **블로킹 (Blocking) 문제 해결**:
   - 일반적으로 JavaScript 코드는 동기적으로 해석되며 실행됩니다. 즉, `<script>` 태그가 HTML 문서 상단에 있으면 브라우저는 JavaScript 코드를 실행하기 전에 스크립트를 다운로드하고 파싱해야 합니다. 이로 인해 페이지의 렌더링이 지연될 수 있습니다.
   - `async` 및 `defer` 속성을 사용하면 JavaScript 파일을 비동기적으로 다운로드하고, 페이지의 렌더링을 차단하지 않고 로딩할 수 있습니다.
2. **`async` 속성**:
   - `<script async>`를 사용하면 JavaScript 파일을 비동기적으로 로드합니다. 이 경우 브라우저는 스크립트 로딩과 페이지 렌더링을 병렬로 처리하므로 스크립트의 다운로드가 완료될 때까지 페이지 렌더링이 차단되지 않습니다.
   - 다만, 스크립트가 로딩 및 실행되는 순서가 보장되지 않으므로 스크립트 간의 의존성이 없는 경우에 사용하는 것이 좋습니다.
3. **`defer` 속성**: - `<script defer>`를 사용하면 JavaScript 파일을 비동기적으로 로드하며, 페이지 렌더링과 병렬로 처리됩니다. 그러나 스크립트는 문서 파싱이 완료된 후에 실행됩니다. - 이는 스크립트가 HTML 문서 내 요소에 의존하는 경우에 유용하며, 스크립트 실행 순서를 보장합니다. 페이지의 DOM 요소에 접근하거나 조작할 때 유용합니다.
   상단에 `<script>` 태그를 사용하면 렌더링 지연 문제가 발생할 수 있으므로, 페이지의 성능과 사용자 경험을 향상시키기 위해 `async` 및 `defer` 속성을 활용하여 스크립트를 비동기적으로 로드하는 것이 좋습니다.
